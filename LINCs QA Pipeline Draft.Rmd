---
title: "Population QA Pipeline"
author: "Mark Dane"
date: "`r Sys.Date()`"
output: pdf_document
---

##Introduction
This vignette demonstrates and explains the MEMA QA pipeline that is based on populaton-level data.

[explanation of LINCs, MEMAs and the Tecan]



```{r setup, echo=FALSE, message=FALSE}
library("ggplot2")
library("data.table")
library("MEMA")

numericMedian <- function(x) as.numeric(median(x))

popDT <- MEMA::popDT

barcodes <- sort(unique(popDT$Barcode))

# Clean up the dataset that will be used in the analysis
popDT <- popDT[!popDT$ShortName =="blank"]
popDT$ShortName <- gsub("blank","",popDT$ShortName)
setnames(popDT,"Ligand","LigandAnnotID")
ms <- gregexpr("^[[:alnum:]]*[^_]", popDT$LigandAnnotID)
popDT$Ligand <- unlist(regmatches(popDT$LigandAnnotID, ms))

```


##MEMA Layout
The LINCs MEMA has 46 ECM proteins spotted in 35 rows and 20 columns. The proteins are randomly assigned to the top 30 rows of spots. Rows 31-35 are replicates of rows 1-5. The upper left and bottom right corners are image fiducials in the 488nm channel and there are four blank spots for checking orientation in all channels.     
```{r Content Layout,echo=FALSE, message=FALSE, warnings=FALSE, fig.width=6.5}

#Select only one type of array to display and show the  pattern
DT <- popDT[,list(Block,Position,ShortName,Name,ID,ArrayRow,ArrayColumn),keyby=Well]
DT <- DT["A01",]
DT <- unique(DT,by=NULL)

p <- ggplot(DT,aes(x = ArrayColumn, y = ArrayRow, fill=ShortName))+
  geom_point(shape=21, size = 2.2)+
  #scale_colour_manual(values=c("black", "white"))+
    guides(fill=guide_legend(ncol = 4))+guides( colour = FALSE )+
  theme(legend.text = element_text(size = rel(.5)),legend.title=element_text(size = rel(.5)),plot.title=element_text(size = rel(.8))
       # , plot.margin = unit(c(2, 0.5, 1, 1), "in")
        )+
  scale_y_reverse()+
  xlab("")+ylab("")+
  ggtitle(" \n\nLINCs ECM A Row Layout")
print(p)

```

##Replicate Count
The LINCs MEMA has an average of 15 replicates with a range from 13 to 19.  
```{r Layout Replicate Count,echo=FALSE, message=FALSE, warnings=FALSE, fig.width=6.5}
#Remove the fiducial entries
setkey(DT,ShortName)
DT <- DT[!"fiducial"]
  p <- ggplot(DT, aes(x=ShortName))+
  geom_bar()+geom_hline(yintercept = mean(table(DT$ShortName)), colour="blue")+
  ggtitle(" \n\nCount of Replicate ECM Proteins In LINCs MEMA")+
  xlab("Printed ECM Protein")+ylab("Number of spots")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(.3)),legend.title=element_text(size = rel(.5)))

print(p)

```

##CellMask Signal
